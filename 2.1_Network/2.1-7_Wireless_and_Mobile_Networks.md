# 2.1–7 Wireless and Mobile Networks

> Active recall
> 
> - Explain the difference between **infrastructure-based networks** and **ad hoc networks**, focusing on which components are responsible for which functions.
> - What is a **handoff (handover)**, in what situations is it needed, and why is it important from the perspective of upper-layer protocols (e.g., TCP sessions)?
> - Compared to wired links, describe three fundamental differences in the **physical characteristics** of wireless links (path loss, interference, multipath, fading, etc.).
> - Describe in an A–B–C topology when the **hidden terminal problem** occurs, and explain why CSMA/CD struggles to solve it.
> - 802.11 uses CSMA/CA instead of CSMA/CD. Explain at least two reasons for this, from the perspective of why collision *detection* is difficult.
> - In a cellular network, explain the roles of the **cell**, **base station**, and **core network** in terms of how user data flows through the system.
> - Why does TCP often misinterpret losses on a wireless link as **congestion**? Relate your answer to TCP’s design assumption that “loss ≈ congestion.”
> - Summarize in one sentence each the three main approaches to improving TCP performance over wireless links: **local recovery**, **wireless-aware TCP**, and **split connections**.

---

## 7.1 Overview of Wireless Networks

### Components of a Wireless Network

A wireless network is composed of **wireless hosts**, **wireless links**, **base stations**, and the **network infrastructure**.

Together, these components form the wireless communication environment on top of the underlying (often wired) network, enabling end-to-end data transmission.

### Wireless Host

- A **wireless host** is an end system that runs applications, such as smartphones, tablets, laptops, and IoT devices.
- It typically communicates with a base station or other wireless hosts over a **wireless link**.

### Wireless Link

- A **wireless link** is the communication path that connects a wireless host to the **network infrastructure or another host**.
- Wireless links are used not only at the edge of the network (access networks) but also in parts of the backbone.
- Link quality depends on factors such as **transmission distance, obstacles, interference, and transmit power**.

### Base Station

- A **base station** mediates the **transmission and reception of data** between wireless hosts and the network.
- Examples:
  - **Cell towers** in cellular networks
  - **Access Points (APs)** in Wi-Fi networks
- Being **associated** with a base station means:
  1. The host is within that base station’s wireless coverage area, and  
  2. It sends and receives data to/from the network **through** that base station.

### Infrastructure-Based Network

- In an infrastructure-based network, wireless hosts connect to the Internet **via a base station**.
- The base station relays services such as address assignment, routing, and DNS.
- Wi-Fi, LTE, and 5G are all examples of infrastructure-based wireless networks.

### Ad Hoc Network

- In an **ad hoc network**, there is **no base station**; hosts connect directly to one another.
- Each host must handle functions such as **routing, address management, and name resolution** by itself.
- Examples include military communication networks, disaster recovery networks, and vehicular ad hoc networks (VANETs).

### Handoff (Handover)

- A **handoff (handover)** is the procedure of changing the network attachment point when
  a mobile host moves out of one base station’s coverage area and into another’s.
- In cellular networks, handovers are performed automatically so that ongoing voice calls
  or data sessions are maintained without being dropped.

### Classification of Wireless Networks

Wireless networks can be classified along two dimensions:

1. **Number of hops**: single-hop vs. multi-hop  
2. **Presence of infrastructure**: with infrastructure vs. without infrastructure  

**Single-hop + Infrastructure**

- All communication between hosts and the network
---
## 7.2 Characteristics of Wireless Links and Networks

### Basic Characteristics of the Wireless Environment

**Signal Attenuation and Path Loss**

- Wireless signals naturally weaken due to **increased distance**, **obstacles (walls, buildings)**, and **spatial dispersion**.
- This decrease in signal strength is called **path loss**.
- Because of this, signal quality varies greatly depending on distance and environment → this is why Wi-Fi or cellular signal strength can differ from room to room.

**Interference**

- Signals from multiple transmitters using the **same frequency band** interfere with one another.
- Nearby Wi-Fi, microwave ovens, Bluetooth devices, etc. can all create interference.
- For this reason, recent Wi-Fi standards use less congested bands such as **5 GHz / 6 GHz**.

**Multipath Propagation**

- Wireless signals can be reflected off walls or the ground and **arrive via multiple paths**.
- This can make the received signal blurry and the data rate unstable.
- Wi-Fi mitigates this problem using **OFDM (Orthogonal Frequency Division Multiplexing)**.

### Error Characteristics of Wireless Links

**Increased Bit Errors**

- Due to obstacles, interference, and reflections, **wireless links have far more bit errors than wired links**.
- Therefore, Wi-Fi (802.11) uses:
  - Strong **CRC**, and  
  - **Link-layer retransmissions (ARQ)**  
  to recover from errors.

### Hidden Terminal Problem

- Suppose A and C cannot hear each other, but
  **both transmit to B at the same time** → at B, their signals interfere.
- However, since A and C cannot detect each other, they **cannot avoid the collision**.
- Wi-Fi addresses this problem using mechanisms such as **RTS/CTS**.

### Fading

- A phenomenon where signal strength **suddenly drops** at a particular location or moment.
- Caused by reflection, refraction, and changes in the surrounding environment.
- Very common in mobile scenarios (smartphones, vehicles).

### CDMA (Code Division Multiple Access)

**Core Idea**

- Instead of dividing time or frequency, CDMA divides by **code**, allowing simultaneous transmission.
- Each transmitter is assigned a **unique code**, and  
  the receiver uses that code to extract the intended signal.

**Advantages**

- Even if multiple transmitters send at the same time, their signals can be **mathematically separated**.
- Used in cellular systems (e.g., 3G) and some wireless networks.

---

## 7.3 Wi-Fi: 802.11 Wireless LAN

### Core Concepts of 802.11

- The most widely used **wireless LAN standard (Wi-Fi)**.
- Includes many generations such as 802.11b/g/n/ac/ax.
- All of them use **CSMA/CA-based medium access**.
- Operate in the **2.4 GHz / 5 GHz** bands.
- Signals are highly unstable (due to interference, fading), and unlike Ethernet, **collision detection is not feasible** → a **collision avoidance** mechanism is required.

### Key 802.11 Architecture

**BSS (Basic Service Set)**

- Consists of an AP and multiple wireless stations.
- Home and enterprise Wi-Fi environments are typically **infrastructure mode** (BSS + AP).

**Association with an AP**

To use the network, a wireless station must be **associated with exactly one AP**.

- The AP periodically sends **Beacon frames** (including SSID and MAC address).
- Stations choose which AP to associate with based on these Beacons  
  (Passive scanning: listening for Beacons / Active scanning: sending Probe Requests).

After association, the station obtains an IP address in the AP’s subnet via **DHCP**.

**Ad-hoc Mode**

A mode in which stations connect directly **without an AP**. In practice, it is rarely used.

### 802.11 MAC Protocol

**Key Difference: CSMA/CD vs. CSMA/CA**

Reasons 802.11 uses CSMA/CA instead of CSMA/CD:

1. The transmitted signal is so strong at the sender that **collisions cannot be detected by listening while sending**.
2. Hidden terminals and fading make collision detection itself impractical.

As a result:

- 802.11 performs **collision avoidance, not collision detection**.
- Basic procedure: Backoff → channel sensing → countdown → transmit → ACK.

**Handling Frame Loss**

Because losses and errors are common on wireless links:

- The **link layer** itself performs ACKs and retransmissions (ARQ).

(This **link-layer ACK** is separate from the TCP ACK in the transport layer.)

**Solving the Hidden Terminal Problem: RTS/CTS**

- Before sending a long DATA frame, the sender exchanges short **RTS → CTS** control frames to reserve the channel.
- Other stations that hear these frames refrain from transmitting during the reserved period.
- This shrinks the “collision window” to short control frames, reducing the impact of collisions.

### 802.11 Frame Structure

**Major Difference: Up to Four MAC Addresses**

Because 802.11 must interconnect **wireless and wired** segments, it needs various addresses such as the **source, destination, AP, and router interface**.

Example:

- Address 1: Final receiver (station or AP)
- Address 2: Frame sender
- Address 3: Router interface address
- Address 4: Used in ad-hoc mode

**CRC**

Since wireless links are more error-prone than wired links, 802.11 uses a 32-bit CRC for error detection.

### Mobility – Movement Within the Same Subnet

- Multiple APs can belong to the **same subnet** (several BSSs in one subnet).
- When a station moves from AP1 to AP2, it can **keep the same IP address**.
- The switch updates its forwarding table for host H1 by **broadcasting frames with H1 as the source** to learn the new port.

→ The TCP session continues without being broken.

**What if It Moves to a Different Subnet?**

- The IP address changes → in principle, existing TCP connections break.  
  → Mechanisms such as **Mobile IP** are needed at higher layers.

### Bluetooth (PAN)

- Operates in the 2.4 GHz ISM band.
- Uses TDM and **FHSS (Frequency Hopping Spread Spectrum)**.
- Infrastructure-less, **ad-hoc-based piconet** (up to 8 active devices).
- A central device (the **master**) controls communication via polling.
- Although Bluetooth and Wi-Fi occupy similar layers in the stack, their **usage scenarios and protocols are completely different**.

---
## 7.4 Cellular Networks: 4G, 5G

### Overview of Cellular Networks

- A cellular network divides a large geographic area into many **cells**, each served by a **base station**.
- Mobile devices (smartphones, etc.) communicate wirelessly with the nearest base station, which connects them to the carrier’s **core network**.
- The size and coverage of a cell depend on factors such as transmit power, obstacles, and base station antenna height.

Core components:

- **UE (User Equipment)**: Smartphones, IoT devices, etc.
- **Base Station (eNB)**: Manages the radio channel, scheduling, and handovers.
- **Core Network**: Handles authentication, mobility management, and connectivity to the Internet.

### 4G LTE Network Architecture

**Main Components**

**UE (User Equipment)**

- End devices such as smartphones and tablets.
- Network endpoint that is assigned an IP address.
- Subscriber is identified by the **IMSI** stored in the SIM card.

**Base Station (eNodeB)**

- Manages radio resources and handles device access.
- Performs handover when the device moves between cells.

**MME (Mobility Management Entity)**

- The core entity of the **control plane**.
- Performs device authentication (in cooperation with the HSS), location tracking, and mobility management between base stations.
- Does not appear on the actual data forwarding path.

**HSS (Home Subscriber Server)**

- Database storing subscriber information and authentication keys.

**S-GW / P-GW**

- **S-GW (Serving Gateway)**: Intermediate gateway that maintains the data path as the device moves.
- **P-GW (PDN Gateway)**:
  - Assigns IP addresses to devices (including NAT).
  - Main gateway that connects to external networks (the Internet).

**Data Path (Tunneling)**

- From UE to eNodeB to S-GW to P-GW, communication is carried over **GTP tunnels**.
- Each flow is distinguished by a Tunnel ID (TEID).
- The base station encapsulates packets in UDP inside the tunnel and sends them to the S-GW/P-GW.

### LTE Protocol Stack (Link Layer)

The LTE radio link is composed of three sublayers:

**PDCP (Packet Data Convergence Protocol)**

- Performs IP header compression.
- Handles encryption/decryption over the radio link.

**RLC (Radio Link Control)**

- Fragments and reassembles IP datagrams.
- Provides reliability via ARQ-based retransmissions.

**MAC (Medium Access Control)**

- Schedules radio resources.
- Uses FEC (Forward Error Correction).

**OFDM Radio Frame Structure**

- LTE uses OFDM, combining **frequency × time slots**.
- Scheduling is done in time slots (0.5 ms), allowing different bit rates per device.
- Slot assignments can be changed every few milliseconds → highly adaptive.

### Attach Procedure & Power Management

**1) Network Attach Procedure**

1. **Cell Search**
   - UE acquires cell information via primary/secondary synchronization signals.

2. **Mutual Authentication**
   - Authentication is performed among the UE, MME, and HSS.

3. **PDN Path Establishment**
   - The MME sets up tunnels between the UE, eNodeB, S-GW, and P-GW.

**2) Power Management (Sleep Modes)**

- **DRX (Discontinuous Reception)**
  - “Light sleep” with periodic wake-up.
  - Saves battery while still detecting downlink packets.

- **Idle State**
  - “Deep sleep” mode.
  - The UE does not notify the network when moving between cells.
  - The MME wakes the UE using paging when there is incoming traffic.

### 5G Networks

**Goals**

Compared to 4G, 5G aims for:

- 10× higher data rates  
- 10× lower latency  
- 100× higher traffic capacity  
- Support for ultra-dense device deployments (including IoT)

**Frequency Bands**

- **FR1**: 450 MHz – 6 GHz
- **FR2**: 24 – 52 GHz (millimeter wave)
  - Advantage: Large spectrum → very high throughput
  - Disadvantage: Short range and highly sensitive to obstacles → requires small cells

**Major 5G Service Models**

- **eMBB (enhanced Mobile Broadband)**: High-speed mobile broadband.
- **URLLC (Ultra-Reliable Low-Latency Communications)**: Ultra-low latency (≈1 ms) for applications such as autonomous driving and industrial automation.
- **mMTC (massive Machine Type Communications)**: Massive IoT connectivity.

**Key Technologies**

- Massive MIMO  
- Beamforming  
- Dense small-cell architectures  

**5G Core Network (Service-Based Architecture)**

- **UPF (User Plane Function)**
  - User plane functions.
  - Can be distributed toward the edge to reduce latency.

- **AMF (Access & Mobility Management Function)**
  - Manages access, authentication, and mobility.

- **SMF (Session Management Function)**
  - Manages sessions/tunnels and IP address allocation.

In essence, 5G splits and virtualizes the roles played by the MME, S-GW, and P-GW in 4G, forming a more flexible, service-based core.

---

## 7.5 Principles of Mobility Management

### Device Mobility from the Network Layer Perspective

**Core Idea**

- **Mobility** means that a device **changes its point of attachment to the network over time**.
- From the network’s viewpoint, the key question is:  
  “Can we maintain ongoing connections (e.g., TCP sessions) while the device moves?”

**Four Levels (Spectrum) of Mobility**

1. **Moving between networks while powered off**
   - Not considered mobility from the network’s perspective.

2. **Moving within a single wireless network**
   - The device stays connected to the same AP or base station → no real mobility issue.

3. **Maintaining a connection while moving within the same operator’s network (practical mobility begins here)**
   - Requires **handover** between APs/base stations.
   - The network must transfer state to keep TCP connections alive.

4. **Maintaining a connection while moving to another operator’s network (roaming)**
   - Requires more complex handover, authentication, charging, and address management.

Key point: **The network must continuously track the device’s location and provide handover.**

### Home Network and Visited Network (Roaming)

**Concept**

- A cellular device has a **home network**.
- When it connects in another carrier’s service area, it is in a **visited network** and is considered roaming.

**Role of the Home Network**

- Stores subscriber identifiers (IMSI, permanent IP, etc.), authorization, and billing information.
- When the visited network registers the device’s location with the home network,
  the home network can **track which network the device is currently in**.

Key idea: **The device’s permanent identity is managed by the home network, while its current location is dynamically registered in the visited network.**

### Routing to a Mobile Device: Three Approaches

To deliver packets, the network must know **where the mobile device is currently attached**.

Among three approaches, the practically used ideas are **indirect routing** and **direct routing**.

**1) Using the Existing IP Address Infrastructure (Unrealistic)**

- The visited network directly advertises the device’s IP via BGP,
  so the entire Internet learns where the device is.

- In practice, this is not used due to scalability issues.

Key problem: **It is impossible to globally advertise the locations of billions of devices via BGP.**

**2) Indirect Routing (Most Widely Used Conceptually)**

Core idea:

**Always send packets to the device’s home network first;  
the home network then forwards them to the visited network where the device currently resides.**

Summary of the process:

1. The correspondent node simply sends packets to the device’s **permanent address** (e.g., home IP).
2. The home network gateway intercepts these packets.
3. It queries the HSS (or equivalent) to find out where the device currently is.
4. It then **tunnels the packets to the visited network gateway**.
5. The visited network delivers the packets to the mobile device.

Advantages

- The correspondent node doesn’t need to know anything about mobility → **full transparency**.

Disadvantages

- **Triangle routing problem**:  
  Correspondent → Home network → Visited network → Device  
  This is inefficient.

Key idea: **“The home network always sits in the middle at least once.”**

**3) Direct Routing**

Core idea:

**The correspondent node learns which visited network the device is in and tunnels packets directly there.**

Process summary:

1. Before sending data, the correspondent queries the home network (HSS, etc.) for the device’s current location.
2. It obtains the visited network address.
3. It then tunnels packets **directly to the visited network**.

Advantages

- Eliminates the triangle routing problem → shorter paths.

Issues

- When the device moves again, the correspondent must be informed of the new visited network.
- Requires a separate **location update protocol**.

Key idea: **Faster and more efficient, but significantly more complex.**
---
## 7.6 Mobility Management in Practice

### Mobility Management in 4G/5G Networks

**Concept Summary**

- 4G/5G networks are designed so that a mobile device can **maintain its connection (IP session) while moving between base station cells**.
- To support mobility, the network:
  
  **(1) Tracks the device’s location in the control plane**, and  
  **(2) Maintains tunnel-based forwarding paths in the data plane**.

- Key components:

  **Base station (eNodeB/gNodeB), MME (4G) / AMF (5G), Serving Gateway (S-GW), PDN Gateway (P-GW), HSS/UDM**

**1) Association with a Base Station**

- The smartphone scans nearby base station signals and selects the most suitable one.
- It sets up a control channel with the base station and provides identifiers such as the IMSI to the network.
- After this process, the device is considered **“registered”** in the visited network.

**2) Control-Plane Setup**

- The base station sends device information to the MME (4G) or AMF (5G).
- The MME/AMF:
  - Queries the home network’s HSS (or UDM) for authentication and subscription information.
  - Updates records of **which visited network the device is currently in**.
- Once the control-plane state is established, the network can set up **data-plane tunnels**.

**3) Data-Plane Tunnel Setup**

- All IP traffic from the mobile device is carried through **GTP tunnels**.
- Tunnel structure:
  1. Device ↔ Base station
  2. Base station ↔ Serving Gateway (S-GW)
  3. S-GW ↔ PDN Gateway (P-GW, in the home network)

- This structure essentially implements the idea of **indirect routing**.
- The P-GW acts as the device’s **“fixed gateway” (permanent home)**.

Key points:

→ Even as the device moves, its traffic always flows through the home P-GW.  
→ The IP address stays the same; only the **location changes**, reflected by updates to the tunnels.

**4) Handover Between Cells**

A handover occurs when the device switches to a new base station.

Basic flow:

1. The device measures the signal strength of neighboring base stations and reports changes.
2. The current base station selects the **target base station** for handover.
3. The target base station reserves resources and sends a handover acceptance.
4. The device switches its connection to the new base station  
   (from the device’s perspective, this is when the handover completes).
5. The network updates the tunnel path from the old base station to the new one.
6. The old base station forwards any remaining buffered data to the new base station to avoid loss.
7. Once the tunnel is fully migrated, the old base station releases resources related to the device.

Key idea:

→ During handover, the network automatically reconfigures **tunnel paths** and **resources** so that IP sessions are not interrupted.

---

### Mobile IP

**Concept Summary**

- The global Internet does **not** have built-in, cell-style mobility support like 4G/5G.
- **Mobile IP** was proposed to solve this by allowing a mobile device to:
  
  **“Keep its permanent IP address while connecting from different networks.”**

**Core Components of Mobile IP**

1. **Home Agent (HA)**
   - Represents the device’s **permanent address**.
   - Receives packets destined for the device and forwards them no matter where the device is.

2. **Care-of Address (COA)**
   - A temporary address assigned to the device in the visited network.
   - Represents the device’s current location.

3. **Foreign Agent (FA)**
   - Located in the visited network; provides and manages COAs for visiting devices.  
     (In modern systems, the device often uses its own COA instead of a separate FA.)

**How Mobile IP Works**

**1) Agent Discovery**

- The Foreign Agent periodically broadcasts that it can provide service in the visited network.
- The mobile device listens to this and obtains a COA.

**2) Registration with the Home Agent**

- The device (or Foreign Agent on its behalf) informs the Home Agent:

  “I am currently at this COA.”

**3) Indirect Routing**

- Packets sent by a correspondent always arrive at the device’s **home address**.
- The Home Agent **tunnels** those packets to the device’s COA.
- This is why Mobile IP’s structure is very similar to the P-GW-based tunnel architecture used in 4G/5G.

**Significance of Mobile IP**

- It aimed to provide mobility over the Internet **without relying on base stations or handover logic inside the IP layer itself**.
- However, due to complexity and security concerns, it has **not been widely deployed**.
- In practice, modern mobility is handled by **cellular networks themselves**,  
  and the Internet is used on top of that largely unchanged.

---

## 7.7 Impact of Wireless and Mobility on Upper-Layer Protocols

### Overview: Effects on Upper Layers

- We have seen that both the **link layer** (fading, interference, hidden terminals) and the **network layer** (handover, mobility management) behave very differently from wired networks.
- So, do these differences affect the **transport layer (TCP/UDP)** and **application layer (web, streaming apps, etc.)**?

Answer: **Yes — the impact is significant.**

In particular, TCP performance can degrade severely in wireless environments, even when the network is not congested.

### Transport Layer: TCP Problems in Wireless/Mobile Environments

**TCP Cannot Distinguish the Cause of Loss**

TCP senders assume **“loss = congestion.”**

Thus, when loss occurs, TCP always:

- Reduces the congestion window (cwnd),
- Decreases the sending rate,
- Retransmits based on timers.

However, in wireless environments, most losses are **not** caused by congestion, but by:

1. **Bit errors on the wireless link (high BER)**  
2. **Fading and interference**  
3. **Delays during handover**  
4. **Short disconnections when switching APs or base stations**

In other words, on wireless links, TCP often **mistakenly interprets non-congestion losses as congestion**,  
and reduces its sending rate more than necessary.

→ This leads to **poor TCP performance**, increased RTTs, and limited throughput.

### Three Approaches to Improving TCP over Wireless

**1) Local Recovery**

- When loss occurs on the wireless link, it is **recovered locally** within the wireless segment.
- Examples: 802.11 ARQ, combinations of ARQ and FEC.
- Advantage: TCP at the sender does **not trigger congestion control unnecessarily**.
- Disadvantage: TCP remains unaware that a wireless segment exists.

Key idea: **Hide wireless errors inside the wireless link itself.**

**2) Making TCP Aware of Wireless Losses**

The idea is to help TCP **distinguish between wireless losses and congestion losses**.

Examples:

- The receiver or AP sends special ACKs/signals to inform the sender:

  “This loss is not due to congestion.”

- In that case, the TCP sender **does not reduce** its congestion window and can keep sending at a higher rate.

Key idea: **Enable TCP to differentiate wireless-induced losses from congestion.**

**3) Split-Connection Approach**

- The end-to-end connection is split into two parts:
  1. Wireless segment: Device ↔ AP (or base station)
  2. Wired segment: AP ↔ Server

Effects:

- The wireless segment can be optimized independently (e.g., using aggressive ARQ for high reliability).
- The server does not need to be aware of wireless conditions.
- Variants of this approach are used in many cellular systems.

Key idea: **Treat the wireless segment separately to compensate for TCP’s weaknesses.**

### Impact on the Application Layer

**Constraints Imposed by Wireless Environments**

- Wireless links typically have **far lower bandwidth** than wired links.
- Due to radio propagation, short-term delays and losses occur frequently.
- Connections can become unstable, especially during handover.

As a result:

- **Streaming services** must use buffering and adaptive bitrate (e.g., HLS, DASH).
- **VoIP and video conferencing** must use codecs that are robust to loss and jitter (often with built-in FEC).
- **Mobile apps** can exploit mobility itself (e.g., location-based services), but must tolerate variable network quality.

Key idea:

**Wireless networks offer lower bandwidth and less stability than wired networks, so application design must be different.**  
At the same time, mobility enables entirely new types of applications that were not possible in purely wired environments.

