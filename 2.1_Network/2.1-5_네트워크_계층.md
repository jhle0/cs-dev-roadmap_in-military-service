# 2.1-5 네트워크 계층

---

## 5.1 네트워크 계층 개요 (Network Layer Overview)

### 역할

- 네트워크 계층(Network Layer)은 **송신 호스트의 트랜스포트 계층 세그먼트를 수신 호스트의 트랜스포트 계층까지 전달**하는 역할을 담당함.
- IP 패킷(데이터그램)의 전달을 위해 **경로를 선택하고 포워딩**을 수행함.
- **라우터(router)** 는 이 과정에서 핵심 역할을 하며, 트랜스포트/애플리케이션 계층은 처리하지 않음.

> 트랜스포트 계층이 “프로세스 간 통신”을 제공한다면,
> 
> 
> 네트워크 계층은 “호스트 간 통신”을 담당한다.
> 

### 네트워크 계층의 두 주요 기능

| 기능 | 설명 | 위치 |
| --- | --- | --- |
| **포워딩 (Forwarding)** | 패킷이 라우터의 입력 포트에 도착했을 때, 올바른 출력 포트로 전달하는 작업 | **데이터 평면 (Data Plane)** |
| **라우팅 (Routing)** | 패킷이 출발지에서 목적지까지 갈 **최적 경로(Route)** 를 결정하는 과정 | **제어 평면 (Control Plane)** |
- **데이터 평면**: 하드웨어에서 실행, 매우 빠른 처리(나노초 단위)
- **제어 평면**: 경로 계산을 위한 소프트웨어 처리, 상대적으로 느림

### 포워딩 테이블 (Forwarding Table)

- 라우터는 **패킷 헤더의 목적지 주소 필드**를 사용하여
    
    **포워딩 테이블(Forwarding Table)** 에서 다음 홉(next hop)을 결정함.
    
- 테이블의 각 항목은 “목적지 주소 → 출력 인터페이스”의 매핑 정보를 가짐.
- 즉, “이 목적지라면 어떤 포트로 내보낼지”를 정의함.

### 제어 평면의 두 가지 접근 방식

### 1. 전통적 접근 (Per-Router Control)

- 각 라우터가 자체적으로 **라우팅 알고리즘을 실행**하여 포워딩 테이블을 계산함.
- 라우터들 간에 **라우팅 메시지를 교환**해 정보 동기화 (예: OSPF, RIP, BGP).
- 라우터가 **포워딩 + 라우팅** 기능을 모두 수행.

### 2. SDN 접근 (Software-Defined Networking)

- **라우팅 계산과 제어 기능을 중앙의 컨트롤러(Controller)** 로 분리.
- 라우터는 단순히 **포워딩만 수행**,
    
    컨트롤러가 **포워딩 테이블을 계산하고 배포**함.
    
- 컨트롤러는 신뢰성과 중복성을 위해 **데이터 센터**에 위치함.

> SDN은 “네트워크의 제어를 소프트웨어적으로 중앙화”한 방식으로,
> 
> 
> 현대 클라우드 인프라의 핵심 기술이다.
> 

### 네트워크 서비스 모델 (Network Service Model)

네트워크 계층이 제공할 수 있는 서비스의 예시는 다음과 같다.

| 서비스 유형 | 설명 |
| --- | --- |
| **보장된 전달 (Guaranteed Delivery)** | 패킷이 목적지까지 반드시 도착하도록 보장 |
| **지연 보장 (Guaranteed Delay)** | 일정 시간(예: 100ms 이하) 안에 전달 보장 |
| **순서 보장 (Ordered Delivery)** | 송신 순서대로 패킷 도착 보장 |
| **최소 대역폭 보장 (Minimum Bandwidth Guarantee)** | 특정 전송 속도를 보장하여 안정된 처리율 확보 |
| **보안 서비스 (Security Service)** | 출발지 암호화, 목적지 복호화를 통한 기밀성 보장 |

### 인터넷 네트워크 계층의 실제 서비스

- 인터넷의 IP 계층은 **최선형 서비스 (Best-Effort Service)** 만 제공한다.
- 즉, 다음은 **보장되지 않는다**:
    - 패킷이 반드시 목적지에 도착함을 보장하지 않음
    - 도착 순서가 유지되지 않을 수 있음
    - 지연 시간에 상한이 없음
    - 대역폭이 일정하지 않음

> IP는 “최선형(Best-Effort)” 원칙만 따르지만,
> 
> 
> 그 단순성과 확장성 덕분에 오늘날 대부분의 네트워크를 구성하고 있다.
>
---
## 5.2 라우터 내부에는 무엇이 있을까? (What’s Inside a Router)

### 개요

- **라우터(Router)** 는 네트워크 계층의 핵심 장비로,
    
    **IP 데이터그램을 한 링크에서 다음 링크로 전달(포워딩)** 하는 역할을 수행함.
    
- “**포워딩(forwarding)**” 과 “**라우팅(routing)**” 중,
    
    라우터는 실제로 **포워딩을 실행하는 데이터 평면(data plane)** 의 중심에 있음.
    

> 라우터는 “패킷이 지나가는 고속 교차로” 역할을 한다.
> 

### 라우터의 주요 구성 요소

| 구성 요소 | 역할 |
| --- | --- |
| **입력 포트(Input Port)** | 패킷 수신, 헤더 검사, 포워딩 테이블 조회, 큐잉 수행 |
| **스위칭 구조(Switching Fabric)** | 입력 포트에서 출력 포트로 패킷을 실제로 이동시키는 내부 네트워크 |
| **출력 포트(Output Port)** | 패킷 스케줄링, 큐잉, 링크 계층으로 전달 |
| **라우팅 프로세서(Routing Processor)** | 라우팅 테이블 관리, 제어 평면 실행 (OSPF, BGP, SDN 제어 포함) |

### 입력 포트 (Input Port)

- 라우터의 **물리적 수신 지점**
- 주요 기능
    - **헤더 검사(Header Check):** IP 헤더의 목적지 주소 추출
    - **포워딩 테이블 조회:** 목적지 주소를 기반으로 **출력 포트 결정**
    - **큐잉(Queueing):** 스위칭 구조로 즉시 전달할 수 없는 경우 입력 대기열에 저장
- 일부 고속 라우터는 입력 포트 단에서 **병렬 포워딩 테이블 캐싱**(Fast Path)을 사용

### 스위칭 구조 (Switching Fabric)

- 라우터의 **데이터 전송 백본**
- **입력 포트 → 출력 포트** 간 패킷을 실제로 이동시키는 경로
- 구현 방식

| 방식 | 설명 |
| --- | --- |
| **메모리 기반 (Memory-based)** | CPU가 메모리를 통해 패킷 복사 (초기 라우터 방식, 느림) |
| **버스 기반 (Bus-based)** | 공유 버스를 통해 전송, 병목 가능 |
| **크로스바(Crossbar) 기반** | 입력–출력 포트를 병렬로 연결, 고속 라우터에서 사용 |
| **인터커넥트(Interconnection)** | 대규모 데이터센터용 다단 스위치 구조 |

> 스위칭 구조의 성능이 라우터의 처리량(bandwidth)을 결정한다.
> 

### 출력 포트 (Output Port)

- **스위칭 구조에서 패킷을 받아 링크 계층으로 내보내는 역할**
- 주요 기능
    - **패킷 버퍼링:** 네트워크 혼잡 시 큐잉
    - **스케줄링(Scheduling):** 어떤 패킷을 먼저 보낼지 결정 (우선순위 큐 등)
    - **링크 계층 처리:** MAC 헤더 부착 및 전송

> 고속 라우터에서는 출력 포트에서도 대기열(queue) 관리가 중요하다.
> 

### 큐잉(Queueing)과 버퍼링(Buffering)

- 입력 포트와 출력 포트 모두에서 발생할 수 있음
- **입력 큐잉(Input Queuing)**
    - 스위칭 구조로 보낼 수 없을 때 입력 포트에 대기
    - “Head-of-Line (HOL) Blocking” 문제 발생 가능
- **출력 큐잉(Output Queuing)**
    - 여러 입력 포트에서 동일한 출력 포트로 트래픽 몰릴 때 대기

> 버퍼 크기가 충분하지 않으면 패킷 손실(drop) 발생 → TCP는 손실로 인식하여 혼잡 제어 수행
> 
### 패킷 스케줄링(Packet Scheduling)

| 알고리즘 | 설명 |
| --- | --- |
| **FIFO (First In First Out)** | 먼저 도착한 패킷을 먼저 전송 |
| **Priority Queuing** | 높은 우선순위 패킷을 먼저 처리 (예: 음성 트래픽) |
| **Round Robin / Fair Queuing** | 여러 큐를 순환하며 공평하게 전송 |
| **Weighted Fair Queuing (WFQ)** | 각 흐름에 가중치를 부여해 공정성 향상 |
