# 2.1-5 네트워크 계층

---

## 5.1 네트워크 계층 개요 (Network Layer Overview)

### 역할

- 네트워크 계층(Network Layer)은 **송신 호스트의 트랜스포트 계층 세그먼트를 수신 호스트의 트랜스포트 계층까지 전달**하는 역할을 담당함.
- IP 패킷(데이터그램)의 전달을 위해 **경로를 선택하고 포워딩**을 수행함.
- **라우터(router)** 는 이 과정에서 핵심 역할을 하며, 트랜스포트/애플리케이션 계층은 처리하지 않음.

> 트랜스포트 계층이 “프로세스 간 통신”을 제공한다면,
> 
> 
> 네트워크 계층은 “호스트 간 통신”을 담당한다.
> 

### 네트워크 계층의 두 주요 기능

| 기능 | 설명 | 위치 |
| --- | --- | --- |
| **포워딩 (Forwarding)** | 패킷이 라우터의 입력 포트에 도착했을 때, 올바른 출력 포트로 전달하는 작업 | **데이터 평면 (Data Plane)** |
| **라우팅 (Routing)** | 패킷이 출발지에서 목적지까지 갈 **최적 경로(Route)** 를 결정하는 과정 | **제어 평면 (Control Plane)** |
- **데이터 평면**: 하드웨어에서 실행, 매우 빠른 처리(나노초 단위)
- **제어 평면**: 경로 계산을 위한 소프트웨어 처리, 상대적으로 느림

### 포워딩 테이블 (Forwarding Table)

- 라우터는 **패킷 헤더의 목적지 주소 필드**를 사용하여
    
    **포워딩 테이블(Forwarding Table)** 에서 다음 홉(next hop)을 결정함.
    
- 테이블의 각 항목은 “목적지 주소 → 출력 인터페이스”의 매핑 정보를 가짐.
- 즉, “이 목적지라면 어떤 포트로 내보낼지”를 정의함.

### 제어 평면의 두 가지 접근 방식

### 1. 전통적 접근 (Per-Router Control)

- 각 라우터가 자체적으로 **라우팅 알고리즘을 실행**하여 포워딩 테이블을 계산함.
- 라우터들 간에 **라우팅 메시지를 교환**해 정보 동기화 (예: OSPF, RIP, BGP).
- 라우터가 **포워딩 + 라우팅** 기능을 모두 수행.

### 2. SDN 접근 (Software-Defined Networking)

- **라우팅 계산과 제어 기능을 중앙의 컨트롤러(Controller)** 로 분리.
- 라우터는 단순히 **포워딩만 수행**,
    
    컨트롤러가 **포워딩 테이블을 계산하고 배포**함.
    
- 컨트롤러는 신뢰성과 중복성을 위해 **데이터 센터**에 위치함.

> SDN은 “네트워크의 제어를 소프트웨어적으로 중앙화”한 방식으로,
> 
> 
> 현대 클라우드 인프라의 핵심 기술이다.
> 

### 네트워크 서비스 모델 (Network Service Model)

네트워크 계층이 제공할 수 있는 서비스의 예시는 다음과 같다.

| 서비스 유형 | 설명 |
| --- | --- |
| **보장된 전달 (Guaranteed Delivery)** | 패킷이 목적지까지 반드시 도착하도록 보장 |
| **지연 보장 (Guaranteed Delay)** | 일정 시간(예: 100ms 이하) 안에 전달 보장 |
| **순서 보장 (Ordered Delivery)** | 송신 순서대로 패킷 도착 보장 |
| **최소 대역폭 보장 (Minimum Bandwidth Guarantee)** | 특정 전송 속도를 보장하여 안정된 처리율 확보 |
| **보안 서비스 (Security Service)** | 출발지 암호화, 목적지 복호화를 통한 기밀성 보장 |

### 인터넷 네트워크 계층의 실제 서비스

- 인터넷의 IP 계층은 **최선형 서비스 (Best-Effort Service)** 만 제공한다.
- 즉, 다음은 **보장되지 않는다**:
    - 패킷이 반드시 목적지에 도착함을 보장하지 않음
    - 도착 순서가 유지되지 않을 수 있음
    - 지연 시간에 상한이 없음
    - 대역폭이 일정하지 않음

> IP는 “최선형(Best-Effort)” 원칙만 따르지만,
> 
> 
> 그 단순성과 확장성 덕분에 오늘날 대부분의 네트워크를 구성하고 있다.
>
---
## 5.2 라우터 내부에는 무엇이 있을까? (What’s Inside a Router)

### 개요

- **라우터(Router)** 는 네트워크 계층의 핵심 장비로,
    
    **IP 데이터그램을 한 링크에서 다음 링크로 전달(포워딩)** 하는 역할을 수행함.
    
- “**포워딩(forwarding)**” 과 “**라우팅(routing)**” 중,
    
    라우터는 실제로 **포워딩을 실행하는 데이터 평면(data plane)** 의 중심에 있음.
    

> 라우터는 “패킷이 지나가는 고속 교차로” 역할을 한다.
> 

### 라우터의 주요 구성 요소

| 구성 요소 | 역할 |
| --- | --- |
| **입력 포트(Input Port)** | 패킷 수신, 헤더 검사, 포워딩 테이블 조회, 큐잉 수행 |
| **스위칭 구조(Switching Fabric)** | 입력 포트에서 출력 포트로 패킷을 실제로 이동시키는 내부 네트워크 |
| **출력 포트(Output Port)** | 패킷 스케줄링, 큐잉, 링크 계층으로 전달 |
| **라우팅 프로세서(Routing Processor)** | 라우팅 테이블 관리, 제어 평면 실행 (OSPF, BGP, SDN 제어 포함) |

### 입력 포트 (Input Port)

- 라우터의 **물리적 수신 지점**
- 주요 기능
    - **헤더 검사(Header Check):** IP 헤더의 목적지 주소 추출
    - **포워딩 테이블 조회:** 목적지 주소를 기반으로 **출력 포트 결정**
    - **큐잉(Queueing):** 스위칭 구조로 즉시 전달할 수 없는 경우 입력 대기열에 저장
- 일부 고속 라우터는 입력 포트 단에서 **병렬 포워딩 테이블 캐싱**(Fast Path)을 사용

### 스위칭 구조 (Switching Fabric)

- 라우터의 **데이터 전송 백본**
- **입력 포트 → 출력 포트** 간 패킷을 실제로 이동시키는 경로
- 구현 방식

| 방식 | 설명 |
| --- | --- |
| **메모리 기반 (Memory-based)** | CPU가 메모리를 통해 패킷 복사 (초기 라우터 방식, 느림) |
| **버스 기반 (Bus-based)** | 공유 버스를 통해 전송, 병목 가능 |
| **크로스바(Crossbar) 기반** | 입력–출력 포트를 병렬로 연결, 고속 라우터에서 사용 |
| **인터커넥트(Interconnection)** | 대규모 데이터센터용 다단 스위치 구조 |

> 스위칭 구조의 성능이 라우터의 처리량(bandwidth)을 결정한다.
> 

### 출력 포트 (Output Port)

- **스위칭 구조에서 패킷을 받아 링크 계층으로 내보내는 역할**
- 주요 기능
    - **패킷 버퍼링:** 네트워크 혼잡 시 큐잉
    - **스케줄링(Scheduling):** 어떤 패킷을 먼저 보낼지 결정 (우선순위 큐 등)
    - **링크 계층 처리:** MAC 헤더 부착 및 전송

> 고속 라우터에서는 출력 포트에서도 대기열(queue) 관리가 중요하다.
> 

### 큐잉(Queueing)과 버퍼링(Buffering)

- 입력 포트와 출력 포트 모두에서 발생할 수 있음
- **입력 큐잉(Input Queuing)**
    - 스위칭 구조로 보낼 수 없을 때 입력 포트에 대기
    - “Head-of-Line (HOL) Blocking” 문제 발생 가능
- **출력 큐잉(Output Queuing)**
    - 여러 입력 포트에서 동일한 출력 포트로 트래픽 몰릴 때 대기

> 버퍼 크기가 충분하지 않으면 패킷 손실(drop) 발생 → TCP는 손실로 인식하여 혼잡 제어 수행
> 
### 패킷 스케줄링(Packet Scheduling)

| 알고리즘 | 설명 |
| --- | --- |
| **FIFO (First In First Out)** | 먼저 도착한 패킷을 먼저 전송 |
| **Priority Queuing** | 높은 우선순위 패킷을 먼저 처리 (예: 음성 트래픽) |
| **Round Robin / Fair Queuing** | 여러 큐를 순환하며 공평하게 전송 |
| **Weighted Fair Queuing (WFQ)** | 각 흐름에 가중치를 부여해 공정성 향상 |


---

## 5.3 인터넷 프로토콜 (Internet Protocol, IP)

### 개요

- **IP(Internet Protocol)** 은 네트워크 계층의 핵심 프로토콜로,
    
    데이터를 **출발지 → 목적지 호스트**까지 전달하기 위한 **주소 지정 및 포워딩 규칙**을 정의함.
    
- IP는 “**Best-Effort Delivery**” 방식을 따르며, **신뢰성·순서·지연 보장 없음**.
    
    (→ 상위 계층 TCP가 신뢰성을 보완함)
    

### IPv4 데이터그램 구조

| 필드 | 설명 |
| --- | --- |
| **Version (4bit)** | IP 버전을 지정 (IPv4는 4) |
| **Header Length (4bit)** | 헤더의 실제 길이 (옵션 포함 시 가변) |
| **Type of Service (TOS)** | 패킷의 우선순위/서비스 구분 (QoS에 활용) |
| **Total Length (16bit)** | 데이터그램 전체 길이 (최대 65,535B) |
| **Identifier / Flags / Fragment Offset** | 단편화(Fragmentation) 관련 필드 |
| **TTL (Time To Live)** | 패킷의 생존 시간. 라우터 통과 시마다 감소, 0이면 폐기 |
| **Protocol** | 상위 프로토콜 지정 (TCP=6, UDP=17 등) |
| **Header Checksum** | 헤더 오류 검출 (라우터마다 재계산) |
| **Source IP / Destination IP** | 출발지와 목적지 주소 |
| **Options** | 확장 기능 (거의 사용되지 않음) |
| **Data (Payload)** | 트랜스포트 계층 세그먼트 등 실제 데이터 |

> 대부분의 IPv4 헤더 크기는 20B (옵션 없음 기준)
> 
> 
> TCP 세그먼트를 전송할 경우 → IP 20B + TCP 20B = 총 40B 헤더 오버헤드 발생
> 

### IPv4 주소체계

### 인터페이스와 IP 주소

- **IP 주소는 호스트 전체가 아니라 인터페이스(interface)** 에 할당된다.
- 라우터는 여러 네트워크와 연결되어 있으므로 **인터페이스마다 고유한 IP**를 가짐.

> 즉, “IP 주소 = 네트워크 상의 인터페이스 식별자”
> 

### 서브넷 (Subnet)

- **서브넷(Subnet)**: 라우터 없이 직접 연결된 네트워크 집합
- 같은 서브넷의 인터페이스는 **같은 네트워크 프리픽스**를 공유함.
- 예: `223.1.1.0/24`
    - `/24`: 상위 24비트가 네트워크 주소 (나머지 8비트는 호스트 구분용)

> 서브넷을 구하려면, 모든 라우터 인터페이스를 제거했을 때 남는 고립된 네트워크 단위를 확인한다.
> 

### CIDR (Classless Inter-Domain Routing)

- 현대 인터넷 주소 표기 방식: **a.b.c.d/x**
    - `x`: 네트워크 프리픽스(상위 비트 수)
    - 나머지 32−x 비트: 네트워크 내 호스트 식별
- CIDR은 포워딩 테이블 크기를 줄이고, **주소 효율성 향상**

> 클래스 기반 주소 체계(A, B, C)를 대체함 — 더 유연하고 세밀한 네트워크 분할 가능
> 

### 브로드캐스트 주소

- `255.255.255.255`: 동일 서브넷 내 **모든 호스트**에게 패킷 전송

### 주소 블록 할당

- 기관은 **ISP로부터 주소 블록**을 할당받는다.
- ISP는 다시 **ICANN**(Internet Corporation for Assigned Names and Numbers)으로부터 주소 블록을 할당받음.
- ICANN의 역할:
    - **글로벌 IP 주소 관리**
    - **DNS 루트 서버 운영**

### DHCP (Dynamic Host Configuration Protocol)

- 호스트가 **자동으로 IP 주소를 할당받는 프로토콜**
- 추가 정보(서브넷 마스크, 게이트웨이, DNS 서버 등)도 함께 제공
- **4단계 과정:**

| 단계 | 설명 |
| --- | --- |
| ① **DHCP Discover** | 클라이언트 → 네트워크로 브로드캐스트(255.255.255.255) |
| ② **DHCP Offer** | 서버 → 사용 가능한 IP 제안 |
| ③ **DHCP Request** | 클라이언트 → 특정 서버 선택 |
| ④ **DHCP ACK** | 서버 → IP 주소 및 설정 확정 |

> 장점: 자동 구성 (Plug and Play)
> 
> 
> 단점: 이동 시 새 서브넷에서 IP 변경 → 기존 TCP 연결 끊김
> 

### NAT (Network Address Translation)

- **사설 네트워크(Private Network)** 내 여러 호스트가 **하나의 공인 IP**로 외부 통신 가능하게 함
- 내부 주소 예시: `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`
- 외부로는 라우터가 **단일 IP(예: 138.76.29.7)** 로 대표함

| 구성요소 | 역할 |
| --- | --- |
| **NAT 변환 테이블** | 내부 사설 IP:포트 ↔ 외부 공인 IP:포트 매핑 |
| **출발지 IP 변환** | 내부 → 외부 통신 시, NAT 라우터의 공인 IP로 변경 |
| **목적지 IP 변환** | 응답 시, NAT 테이블 참조하여 내부 호스트로 전달 |

> NAT 라우터는 내부 구조를 숨기며, 외부에서 보면 “하나의 장치”처럼 보인다.
> 

**문제점:**

- 외부에서 내부 서버 접근 어려움 (P2P, 웹 서버 등)
- 해결: **NAT traversal 기술 (예: STUN, TURN, UPnP)**

### IPv6

### 등장 배경

- IPv4 주소(32bit) 고갈로 인해 **128bit 주소 공간의 IPv6** 등장
- IPv4 → IPv6 전환은 점진적으로 이루어지고 있음

### IPv6 데이터그램 구조

| 필드 | 설명 |
| --- | --- |
| **Version (4bit)** | 6으로 지정 |
| **Traffic Class (8bit)** | 패킷 우선순위 지정 |
| **Flow Label (20bit)** | 동일한 흐름(flow) 식별용 |
| **Payload Length (16bit)** | 헤더 이후 데이터 크기 |
| **Next Header** | 상위 프로토콜(TCP, UDP 등) |
| **Hop Limit** | TTL 역할, 0이 되면 폐기 |
| **Source/Destination Address** | 128bit IP 주소 |
| **Data** | 트랜스포트 계층 데이터 |

> IPv6 헤더는 40바이트 고정 길이이며, 단순화로 라우터 처리 속도 향상.
> 

### IPv6의 주요 변화

- **주소 확장:** 128비트 → 사실상 무한한 주소 공간
- **헤더 단순화:** 단편화, 체크섬 제거 → 빠른 처리
- **Flow Label 추가:** QoS 및 실시간 트래픽 구분 가능
- **옵션 필드 제거:** 필요 시 “확장 헤더” 형태로 분리

### IPv4와 IPv6의 비교

| 항목 | IPv4 | IPv6 |
| --- | --- | --- |
| **주소 길이** | 32bit | 128bit |
| **헤더 크기** | 가변(20~60B) | 고정(40B) |
| **체크섬** | 있음 | 없음 |
| **단편화** | 모든 라우터 | 송·수신지에서만 |
| **보안** | 선택적 (IPSec) | 기본 내장 |
| **주소 표현** | 4옥텟 (e.g. 192.168.0.1) | 8블록 16진수 (e.g. 2001:0db8::1) |

### IPv4 → IPv6 전환 방법

- **Flag Day** (전면 교체): 현실적으로 불가능 (수억 대 장비 존재)
- **터널링 (Tunneling):**
    - IPv6 데이터그램을 IPv4 데이터그램의 **페이로드로 캡슐화**
    - IPv4 라우터는 IPv6 내용을 인식하지 못하고 그대로 전달
    - 터널 끝단에서 IPv6 패킷 복원

> 예: IPv6 호스트 B ↔ E 간 통신 시, 중간 IPv4 네트워크를 터널로 사용
> 

---

## 5.4 일반화된 포워딩 및 소프트웨어 기반 네트워크 (Generalized Forwarding & Software-Defined Networking, SDN)

### 개요

- 기존 라우터는 **목적지 IP 주소 기반 포워딩(Destination-based forwarding)** 을 수행.
    
    → 즉, “목적지 주소가 무엇인가?”만을 기준으로 출력 포트를 결정.
    
- 하지만 현대 네트워크는 **더 복잡한 정책과 트래픽 제어**가 필요함.
    
    → 단순히 IP 목적지뿐 아니라 **다양한 헤더 필드(출발지, 프로토콜, 포트 등)** 를 기반으로 제어 가능해야 함.
    

> 이를 위해 등장한 개념이 “매치 + 액션(match + action)” 기반의 일반화된 포워딩(Generalized Forwarding) 이다.
> 

### 1) 매치 플러스 액션 (Match + Action)

- 모든 패킷은 **여러 계층의 헤더 필드**를 기준으로 “매치(match)” 되고,
    
    그에 따라 지정된 “액션(action)”을 수행함.
    

### Match: 어떤 조건의 패킷인가?

- 패킷 헤더의 다양한 필드를 기반으로 규칙을 비교
    
    (예: IP 주소, 포트 번호, MAC 주소, 프로토콜 등)
    
- **와일드카드(Wildcard)** 사용 가능 → 범위 지정 (예: `128.119.*.*`)
- 여러 규칙이 일치할 경우 **우선순위(priority)** 가 높은 항목이 적용됨.

### Action: 일치 시 어떤 동작을 수행할 것인가?

- 특정 **출력 포트로 포워딩**
- 패킷을 **복사 또는 삭제**
- **헤더 필드 수정 (rewrite)**
- **컨트롤러로 전송 (encapsulation 후)** — 고급 처리 수행
- **로드 밸런싱**, **방화벽 차단**, **QoS 우선순위 지정** 등 다양한 정책 가능

> 즉, “패킷이 어떤 규칙에 맞으면 무엇을 할지”를 명시하는 플로우 테이블(Flow Table) 기반 구조이다.
> 

### 2) OpenFlow: SDN의 핵심 프로토콜

- **OpenFlow 1.0** 은 SDN의 첫 표준으로,
    
    네트워크 장비가 **컨트롤러로부터 제어받는 구조**를 명확히 제시함.
    

### OpenFlow 스위치 구조

- 각 스위치는 **플로우 테이블(Flow Table)** 을 가지고 있음.
- 각 엔트리(Flow Entry)는 다음 정보를 포함함:

| 구성 요소 | 설명 |
| --- | --- |
| **Match Fields** | 매칭 조건 (예: IP 주소, TCP 포트 등) |
| **Counters** | 해당 규칙과 일치한 패킷 수, 바이트 수 등 |
| **Actions** | 매칭된 패킷에 수행할 동작(포워딩, 삭제, 수정 등) |

> 매칭되지 않은 패킷은 컨트롤러로 전달되어 새 규칙을 추가하거나, 더 세밀한 정책을 적용할 수 있다.
> 

### 3) 매치 (Match)의 동작 예시

- OpenFlow 1.0에서는 **11개의 주요 헤더 필드 + 입력 포트 ID**를 기준으로 매칭 가능
- 매치 필드는 OSI 모델의 다양한 계층에 걸쳐 있음
    - L1 (물리): 입력 포트
    - L2 (링크): MAC 주소
    - L3 (네트워크): IP 주소
    - L4 (트랜스포트): TCP/UDP 포트 번호
- 단, 모든 필드가 가능한 것은 아님 → 예: TTL, 데이터그램 길이 등은 매치 불가

> 즉, SDN 스위치는 단순한 “라우터”가 아니라
> 
> 
> **L2~L4 전 계층의 조건을 기반으로 패킷을 제어하는 프로그래머블 장치**이다.
> 

### 4) 액션 (Action)의 주요 유형

| 액션 | 설명 |
| --- | --- |
| **Forwarding** | 지정된 포트로 전송, 브로드캐스트 또는 멀티캐스트 수행 |
| **Send to Controller** | 컨트롤러로 패킷 전달 (정책 결정 or 플로우 추가) |
| **Drop/Delete** | 매칭된 패킷을 폐기 |
| **Modify-Field** | 특정 헤더 필드를 재작성 (예: MAC, IP 변경) |
| **Encapsulate** | 패킷을 캡슐화해 외부 처리 장치로 전달 |

> 여러 액션이 동시에 지정될 수 있으며, 리스트 순서대로 수행된다.
> 

### 5) 매치+액션의 실제 활용 예

**1. 단순 포워딩(Simple Forwarding)**

- s1 스위치에서 h5 → h3 트래픽을 특정 포트로 전달
- 각 스위치(s1, s2, s3)는 플로우 테이블에 “목적지 IP + 출력 포트” 매핑을 등록

**2. 로드 밸런싱(Load Balancing)**

- h3에서 특정 IP 범위(`10.1.*.*`)로 가는 트래픽은 s1→s2 경로,
    
    h4에서 동일한 목적지로 가는 트래픽은 s3→s2 경로로 분산
    
- 목적지 기반 포워딩으로는 불가능한 동작이지만,
    
    매치+액션 규칙으로 “출발지별 라우팅 정책” 구현 가능
    

**3. 방화벽(Firewall)**

- s2 스위치에 “`10.3.*.*` 만 허용, 나머지는 drop” 규칙 추가
- 플로우 테이블에 허용 정책 외 다른 매치는 **패킷 삭제(Drop)**
    
    → 네트워크 수준의 접근 제어 구현 가능
    

### 6) SDN의 핵심 아이디어

| 기존 네트워크 | SDN (Software-Defined Network) |
| --- | --- |
| 제어 평면과 데이터 평면이 **한 장비 내부에 통합** | 제어 평면을 **중앙 컨트롤러로 분리** |
| 각 라우터가 개별적으로 라우팅 계산 | 중앙 컨트롤러가 **전체 네트워크 정책을 계산** |
| 하드웨어 중심 (전용 펌웨어) | **소프트웨어 중심 (OpenFlow, API 기반)** |
| 네트워크 구조 변경 어려움 | **정책·라우팅 규칙을 소프트웨어로 즉시 변경 가능** |

> SDN은 “네트워크의 제어 로직을 중앙화하고, 하드웨어는 단순 포워더로 만든다”는 철학을 가진다.
> 

### 요약

- **일반화된 포워딩(Generalized Forwarding)** 은
    
    “목적지 주소만”이 아닌 **다양한 헤더 필드 기반의 매치+액션 구조**로 동작
    
- **OpenFlow** 는 이러한 구조를 표준화한 **SDN의 핵심 프로토콜**
- **컨트롤러가 네트워크 전체를 중앙에서 제어**,
    
    각 스위치는 플로우 테이블만으로 포워딩 수행
    
- 이를 통해 로드 밸런싱, 방화벽, QoS 등 **정책 기반 네트워크 제어**가 가능해짐

---

## 5.5 미들박스 (Middlebox)

### 개념

- **미들박스(Middlebox)** 는
    
    **출발지와 목적지 호스트 사이의 데이터 경로 상에서**,
    
    **표준 IP 라우터의 기본 포워딩 기능을 넘어서는 작업을 수행하는 장치**를 의미한다.
    
- 즉, 단순히 “패킷을 전달”하는 역할을 넘어서,
    
    **트래픽 제어·보안·성능 향상** 등의 추가 기능을 수행한다.
    

> “라우터는 패킷을 전달하지만, 미들박스는 패킷을 해석하고 개입한다.”
> 

### 주요 기능 유형

| 유형 | 설명 | 대표 예시 |
| --- | --- | --- |
| **NAT 변환 (Network Address Translation)** | IP 주소 및 포트 번호를 재작성하여 사설 네트워크 주소체계를 구현 | NAT 라우터, 홈 게이트웨이 |
| **보안 서비스 (Security Services)** | 트래픽을 감시·차단·분석하여 보안 강화 | 방화벽(Firewall), IDS/IPS, DPI(Deep Packet Inspection) |
| **성능 향상 (Performance Optimization)** | 네트워크 효율 향상 또는 부하 분산 수행 | 프록시 서버, 로드 밸런서, 트래픽 압축기 |

### 주요 미들박스 동작 예시

1. **NAT 박스**
    - 트랜스포트 계층의 포트 번호와 네트워크 계층의 IP 주소를 모두 수정함.
    - 내부 IP를 숨기고, 공인 IP 하나로 외부와 통신.
    - 애플리케이션 계층 정보가 IP·포트 변경에 의존할 경우(예: FTP, SIP 등) 문제 발생 가능.
2. **방화벽(Firewall)**
    - IP, TCP, UDP, 애플리케이션 헤더를 검사하여 트래픽을 허용 또는 차단.
    - 일부는 패킷의 내용(payload)을 분석하는 **DPI(Deep Packet Inspection)** 기능을 수행.
    - 네트워크 계층뿐만 아니라 상위 계층까지 접근하기 때문에, 계층 간 경계를 침범함.
3. **침입 탐지 시스템 (IDS/IPS)**
    - 트래픽 흐름 내에서 **비정상 패턴, 공격 시그니처**를 탐지.
    - 탐지 시 패킷을 차단하거나 관리자에게 경고.
    - 머신러닝 기반 이상 탐지(Anomaly Detection)로 진화 중.
4. **로드 밸런서 (Load Balancer)**
    - 동일 서비스를 제공하는 여러 서버 중 하나로 트래픽 분산.
    - DNS 수준, L4(포트 기반), L7(HTTP 헤더 기반) 등 다양한 계층에서 동작 가능.
    - 클라우드 환경에서는 **리버스 프록시 형태**로 구현되는 경우가 많음.

### 네트워크 계층 구조와의 관계

- 미들박스는 **전통적인 네트워크 계층 분리 원칙**을 위반함.
    - 라우터: 네트워크 계층까지만 참조
    - 미들박스: 트랜스포트 및 애플리케이션 계층까지 **헤더와 데이터에 접근**
- 예시:
    - NAT는 **IP 계층의 주소**와 **TCP/UDP 포트 번호(트랜스포트 계층)** 를 수정.
    - 방화벽은 **HTTP 헤더** 등 **애플리케이션 계층 데이터**까지 검사.

> 즉, 미들박스는 “네트워크 계층의 경계를 넘나드는 존재”다.
> 

### 논쟁과 관점

| 입장 | 설명 |
| --- | --- |
| **부정적 시각** | “아키텍처적으로 혐오스럽다(architecturally dirty)” — 계층적 독립성 위반, 프로토콜 설계 복잡화 유발 |
| **긍정적 시각** | 실제로는 “필수적이고 영구적인 존재” — 보안, 성능, 정책 관리에 실질적 필요 |

> 현실적으로 오늘날의 인터넷은 수많은 미들박스를 기반으로 안정성과 보안을 유지하고 있다.
>
